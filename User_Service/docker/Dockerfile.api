FROM node:18-alpine

WORKDIR /app

# Copiar apenas os arquivos de package primeiro
COPY package*.json ./

# Instalar dependências
RUN apk add --no-cache python3 make g++ && \
    npm ci --only=production && \
    npm rebuild bcrypt --build-from-source

# Copiar o resto dos arquivos
COPY . .

# Limpar cache e arquivos desnecessários
RUN npm cache clean --force && \
    rm -rf /var/cache/apk/*

EXPOSE 3000

CMD ["npm", "start"] 